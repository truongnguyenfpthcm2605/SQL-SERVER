create database QLDA_PS22237_leminhdat
go
use QLDA_PS22237_leminhdat

CREATE TABLE NHANVIEN
(
	HONV NVARCHAR(15) NOT NULL,
	TENLOT NVARCHAR(15) NOT NULL,
	TENNV NVARCHAR(15) NOT NULL,
	MANV VARCHAR(9) PRIMARY KEY NOT NULL,
	NGSINH DATE NOT NULL,
	DCHI NVARCHAR(30) NOT NULL,
	PHAI NVARCHAR(3) NOT NULL,
	LUONG SMALLMONEY NOT NULL,
	MA_NQL VARCHAR(9),
	PHG smallint NOT NULL
)

CREATE TABLE PHONGBAN(
	TENPHG NVARCHAR(15) NOT NULL,
	MAPHG smallint PRIMARY KEY NOT NULL,
	TRPHG VARCHAR(9) NOT NULL,
	FOREIGN KEY(TRPHG) REFERENCES NHANVIEN(MANV),
	NG_NHANCHUC DATE NOT NULL
)

CREATE TABLE DIADIEM_PHG(
	MAPHG SMALLINT NOT NULL,
	DIADIEM NVARCHAR(15) NOT NULL,
	FOREIGN KEY(MAPHG) REFERENCES PHONGBAN(MAPHG),
	PRIMARY KEY(MAPHG,DIADIEM),
)

CREATE TABLE DEAN(
	TENDA NVARCHAR(15) NOT NULL,
	MADA SMALLINT NOT NULL PRIMARY KEY,
	DDIEM_DA NVARCHAR(15) NOT NULL,
	PHONG SMALLINT NOT NULL,
	FOREIGN KEY(PHONG) REFERENCES PHONGBAN(MAPHG),
)

CREATE TABLE CONGVIEC (
	MADA SMALLINT NOT NULL,
	STT SMALLINT  NOT NULL,
	TEN_CONG_VIEC NVARCHAR(50) NOT NULL,
	PRIMARY KEY(MADA,STT),
	FOREIGN KEY(MADA) REFERENCES DEAN(MADA),
)

CREATE TABLE PHANCONG(
	MA_NVIEN VARCHAR(9) NOT NULL,
	MADA SMALLINT NOT NULL,
	STT SMALLINT  NOT NULL,
	THOIGIAN SMALLINT NOT NULL,
	FOREIGN KEY(MADA,STT) REFERENCES CONGVIEC(MADA,STT),
	FOREIGN KEY(MA_NVIEN) REFERENCES NHANVIEN(MANV),
	PRIMARY KEY(MA_NVIEN,MADA,STT),
)

CREATE TABLE THANNHAN(
	MA_NVIEN VARCHAR(9) NOT NULL,
	TENTN NVARCHAR(15) NOT NULL,
	PHAI NVARCHAR(3) NOT NULL,
	NGSINH DATE NOT NULL,
	QUANHE NVARCHAR(15) NOT NULL,
	FOREIGN KEY(MA_NVIEN) REFERENCES NHANVIEN(MANV),
	PRIMARY KEY(MA_NVIEN,TENTN)
)

INSERT INTO NHANVIEN VALUES
(N'Đinh',N'Bá',N'Tiên','009','02/11/1960',N'119 Cống Quỳnh, Tp HCM','Nam',30000,'005',5),
(N'Nguyễn',N'Thanh',N'Tùng','005','08/20/1962',N'222 Nguyễn Văn Cừ, Tp HCM','Nam',40000,'006',5),
(N'Bùi',N'Ngọc',N'Hằng','007','03/11/1954',N'332 Nguyễn Thái Học, Tp HCM','Nam',25000,'001',4),
(N'Lê',N'Quỳnh',N'Như','001','02/01/1967',N'291 Hồ Văn Huê, Tp HCM','Nữ',43000,'006',4),
(N'Nguyễn',N'Mạnh',N'Hùng','004','03/04/1967',N'95 Bà Rịa Vũng Tàu','Nam',38000,'005',5),
(N'Trần',N'Thanh',N'Tâm','003','05/04/1957',N'34 Mai Thị Lự, Tp HCM','Nam',25000,'005',5),
(N'Trần',N'Hồng',N'Quang','008','09/01/1967',N'80 Lê Hồng Phong, Tp HCM','Nam',25000,'001',4),
(N'Phạm',N'Văn',N'Vinh','006','01/01/1965',N'45 Trưng Vương, Hà Nội','Nữ',55000,Null,1);

INSERT INTO PHONGBAN VALUES
('Nghiên cứu',5,'005','05/22/1987'),
('Điều hành',4,'008','01/01/1985'),
('Quản lý',1,'006','06/19/1971');

INSERT INTO THANNHAN VALUES
('005',N'Trinh',N'Nữ','04/05/1976',N'Con gái'),
('005',N'Khang',N'Nam','10/25/1973',N'Con trai'),
('005',N'Phương',N'Nữ','05/23/1948',N'Vợ Chồng'),
('001',N'Minh',N'Nam','02/29/1932',N'Vợ chồng'),
('009',N'Tiến',N'Nam','01/01/1978',N'Con gái'),
('009',N'Châu',N'Nữ','12/30/1978',N'Con gái'),
('009',N'Phương','Nữ','05/05/1957',N'Vợ chồng');

INSERT INTO DEAN VALUES
(N'Sản phẩm X',1,N'Vũng tàu',5),
(N'Sản phẩm Y',2,N'Nha Trang',5),
(N'Sản phẩm Z',3,N'TP HCM',5),
(N'Tin học hóa',10,N'Hà Nội',4),
(N'Cáp quang',20,N'TP HCM',1),
(N'Đào tạo',30,N'Hà Nội',4);

INSERT INTO DIADIEM_PHG VALUES
(1,N'TP HCM'),
(4,N'Hà Nội'),
(5,N'Tàu'),
(5,N'Nha Trang'),
(5,N'TP HCM');


INSERT INTO CONGVIEC VALUES
(1,1,N'Thiết kế sản phẩm X'),
(1,2,N'Thử nghiệm sản phẩm X'),
(2,1,N'Sản xuất sản phẩm Y'),
(2,2,N'Quảng cáo sản phẩm Y'),
(3,1,N'Khuyến mãi sản phẩm Z'),
(10,1,N'Tin học hóa phòng nhân sự'),
(10,2,N'Tin học hóa phòng kinh doanh'),
(20,1,N'Lắp đặt cáp quang'),
(30,1,N'Đào tạo nhân viên marketing'),
(30,2,N'Đào tạo nhân viên chuyên thiết kế');

INSERT INTO PHANCONG VALUES
('009',1,1,32),
('009',2,2,8),
('004',3,1,40),
('003',1,2,20),
('003',2,1,20),
('008',10,1,35),
('008',30,2,5),
('001',30,1,20),
('001',20,1,15),
('006',20,1,30),
('005',3,1,10),
('005',10,2,10),
('005',20,1,10),
('007',30,2,30),
('007',10,2,10);

ALTER TABLE  NHANVIEN ADD FOREIGN KEY(PHG) REFERENCES PHONGBAN(MAPHG)
ALTER TABLE  NHANVIEN ADD FOREIGN KEY(MA_NQL) REFERENCES NHANVIEN(MANV)


ALTER TABLE NHANVIEN DROP COLUMN TENLOT
ALTER TABLE NHANVIEN ADD TENLOT NVARCHAR(15)