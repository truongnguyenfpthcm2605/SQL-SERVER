/*
BÀI TẬP THỰC HÀNH CUỐI MÔN SQL SEVER 
NGÀY TẠO : 16/06/2022
NGUOI TẠO : NGUYỄN VAN TRUONG - PS24083
*/

CREATE DATABASE QUANLYHANGHOA
ON
(
	NAME = QUANLYHANGHOA_dat,
	FILENAME = 'D:\SUMMER2022\COM2034-SQL SEVER\QUANLYHANGHOA.mdf',
	SIZE = 10,
	MAXSIZE = 50,
	FILEGROWTH = 5
)
LOG ON
(
	NAME = QUANLYHANGHOA_ldf,
	FILENAME = 'D:\SUMMER2022\COM2034-SQL SEVER\QUANLYHANGHOA.ldf',
	SIZE = 10MB,
	MAXSIZE = 50MB,
	FILEGROWTH = 5MB

)
GO
USE QUANLYHANGHOA
GO

CREATE TABLE KHACHHANG
(
	MaKH VARCHAR(9) primary key NOT NULL,
	TenKH NVARCHAR(50),
	DiaChi NVARCHAR(20),
	DienThoai VARCHAR(15)
)
GO
CREATE TABLE DONDATHANG
(
	MaDat VARCHAR(9) primary key NOT NULL,
	NgayDat date default getdate(),
	MaKH VARCHAR(9) NOT NULL ,
	TinhTrang bit,
	CONSTRAINT FK_KH_DONHANG FOREIGN KEY( MaKH) REFERENCES KHACHHANG(MaKH),

)
GO
CREATE TABLE PHIEUGIAOHANG
(
	MaGiao varchar(9) primary key NOT NULL,
	NgayGiao date ,
	MaDat VARCHAR(9) NOT NULL,
	CONSTRAINT FK_DONHANG_PHIEUGIAO FOREIGN KEY( MaDat) REFERENCES DONDATHANG(MaDat),
)
GO
CREATE TABLE HANGHOA
(
	MaHH varchar(9) primary key NOT NULL,
	TenHH NVARCHAR(50),
	DVT NVARCHAR(5),
	SLCon INT CHECK (SLCon >= 0) not null,
	DonGiaHH FLOAT
)
GO
CREATE TABLE CHITIETDATHANG
(
	MaDat VARCHAR(9) NOT NULL,
	MaHH varchar(9) NOT NULL,
	SLDat INT,
	CONSTRAINT FK_DONHANG_CTDATHANG FOREIGN KEY( MaDat) REFERENCES DONDATHANG(MaDat),
	CONSTRAINT FK_HH_CTDATHANG FOREIGN KEY( MaHH) REFERENCES HANGHOA(MaHH),
	PRIMARY KEY (MaDat,MaHH)


)
GO
CREATE TABLE CHITIETGIAOHANG
(
	MaGiao varchar(9) NOT NULL,
	MaHH varchar(9) NOT NULL ,
	SLGiao INT,
	DonGiaGiao FLOAT,
	CONSTRAINT FK_HH_CTGIAOHANG FOREIGN KEY( MaHH) REFERENCES HANGHOA(MaHH),
	CONSTRAINT FK_PHIEUGIAO_CTGIAOHANG FOREIGN KEY( MaGiao) REFERENCES PHIEUGIAOHANG(MaGiao),
	PRIMARY KEY (MaGiao,MaHH)

)
GO
CREATE TABLE LICHSUGIA
(
	MaHH varchar(9) NOT NULL,
	NgayHL date NOT NULL,
	DonGia float,
	CONSTRAINT FK_HH_lICHSUGIA FOREIGN KEY( MaHH) REFERENCES HANGHOA(MaHH),
	primary key(MaHH,NgayHL)
)
GO

INSERT INTO KHACHHANG(MaKH,TenKH,DiaChi,DienThoai) VALUES 
('KH001',N'Cửa Hàng Phú Lộc',N'Đà Nẵng','0511.3246135'),
('KH002',N'Cửa Hàng Hoàng Gia',N'Quảng Nam','0510.6333444'),
('KH003',N'Nguyễn Lan Anh',N'Huế','0988.148.248'),
('KH004',N'Công Ty TNHH An Phước',N'Đà Nẵng','0511.6987789'),
('KH005',N'Huỳnh Ngọc Trung',N'Quảng Nam','0905.888555'),
('KH006',N'Cửa Hàng Trung Tính',N'Đà Nẵng',null)
GO
INSERT INTO DONDATHANG(MaDat,NgayDat,MaKH,TinhTrang) VALUES
('DH01','2011-02-02','KH001',1),
('DH02','2011-02-12','KH003',1),
('DH03','2012-01-22','KH003',1),
('DH04','2012-03-22','KH002',0),
('DH05','2012-04-14','KH005',1),
('DH06','2012-08-05','KH003',1),
('DH07','2012-11-25','KH005',0)
GO
INSERT INTO PHIEUGIAOHANG(MaGiao,NgayGiao,MaDat) VALUES
('GH01','2011-02-02','DH01'),
('GH02','2011-02-15','DH02'),
('GH03','2012-01-23','DH03'),
('GH05','2012-04-20','DH05'),
('GH06','2012-08-05','DH06')
GO
INSERT INTO HANGHOA(MaHH,TenHH,DVT,SLCon,DonGiaHH) VALUES 
('BU',N'Bàn ủi Philip',N'cái',60,350000),
('CD',N'Nồi cơm điện Sharp',N'cái',100,700000),
('DM',N'Đầu máy sharp',N'cái',75,1200000),
('MG',N'Máy giặc SanYo',N'cái',10,4700000),
('MQ',N'Máy quạt ASIA',N'cái',40,400000),
('TL',N'Tủ lạnh Hitachi',N'cái',50,5500000),
('TV',N'TiVi JVC 14WS',N'cái',33,7800000)
GO
INSERT INTO CHITIETDATHANG(MaDat,MaHH,SLDat) VALUES 
('DH01','BU',15),
('DH01','DM',10),
('DH01','TL',4),
('DH02','BU',20),
('DH02','TL',3),
('DH03','MQ',8),
('DH04','TL',5),
('DH04','TV',5),
('DH05','BU',12),
('DH05','DM',15),
('DH05','MQ',6),
('DH05','TL',5),
('DH06','BU',30),
('DH06','MQ',7)
INSERT INTO CHITIETGIAOHANG(MaGiao,MaHH,SLGiao,DonGiaGiao) VALUES
('GH01','BU',15,300000),
('GH01','DM',10,1000000),
('GH01','TL',4,5000000),
('GH02','BU',10,300000),
('GH03','MQ',8,4700000),
('GH05','BU',12,350000),
('GH05','DM',15,1200000),
('GH05','MQ',5,4700000),
('GH05','TL',5,5500000),
('GH06','BU',20,350000),
('GH06','MQ',7,4700000)
GO
INSERT INTO LICHSUGIA(MaHH,NgayHL,DonGia) VALUES 
('BU','01-01-2011',300000),
('BU','01-01-2012',350000),
('CD','06-01-2011',650000),
('CD','01-01-2012',700000),
('DM','01-01-2011',1000000),
('DM','01-01-2012',1200000),
('MG','01-01-2011',4700000),
('MQ','06-01-2011',400000),
('TL','01-01-2011',5500000),
('TL','01-01-2012',5500000),
('TV','01-01-2012',7800000)


SELECT * FROM DONDATHANG